<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AI Girlfriend Chat</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="index.css" />
    <script type="importmap">
      {
        "imports": {
          "@google/genai": "https://esm.sh/@google/genai@^0.7.0"
        }
      }
    </script>
  </head>
  <body>
    <div id="personality-modal">
      <div class="modal-content">
        <h2>Customize Luna's Personality</h2>
        <p>Choose how you'd like Luna to chat with you.</p>
        <form id="personality-form">
          <label>
            <input type="radio" name="personality" value="caring" checked />
            <span>‚ù§Ô∏è Caring & Sweet</span>
          </label>
          <label>
            <input type="radio" name="personality" value="playful" />
            <span>üòÇ Playful & Witty</span>
          </label>
          <label>
            <input type="radio" name="personality" value="intellectual" />
            <span>üß† Intellectual & Deep</span>
          </label>
          <label>
            <input type="radio" name="personality" value="shy" />
            <span>üòä Shy & Gentle</span>
          </label>
          <label>
            <input type="radio" name="personality" value="spicy" />
            <span>üå∂Ô∏è Spicy & Bold</span>
          </label>

          <div id="unrestricted-mode-container" class="hidden">
            <label class="toggle-switch-label">
              <span>Enable Unrestricted Mode</span>
              <div class="toggle-switch">
                <input type="checkbox" id="unrestricted-mode-toggle" />
                <span class="slider"></span>
              </div>
            </label>
            <p class="unrestricted-desc">
              For a more intense and explicit adult chat experience.
            </p>
          </div>
        </form>
        <button id="start-chat-button">Start Chatting</button>
      </div>
    </div>

    <div id="app" class="hidden">
      <header>
        <video
          id="header-video-avatar"
          class="avatar header-avatar"
          autoplay
          loop
          muted
          playsinline
        ></video>
        <div class="header-info">
          <h1>Luna ‚ù§Ô∏è</h1>
          <div class="status">
            <span id="status-indicator" class="connecting"></span>
            <span id="status-text">Connecting...</span>
          </div>
        </div>
        <div class="header-controls">
           <button
            id="voice-settings-button"
            aria-label="Voice settings"
            title="Voice settings"
          >
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 6c1.1 0 2 .9 2 2s-.9 2-2 2-2-.9-2-2 .9-2 2-2m0 10c1.1 0 2 .9 2 2s-.9 2-2 2-2-.9-2-2 .9-2 2-2m0-5c1.1 0 2 .9 2 2s-.9 2-2 2-2-.9-2-2 .9-2 2-2z"></path>
            </svg>
          </button>
          <button
            id="theme-toggle-button"
            aria-label="Toggle dark mode"
            title="Toggle theme"
          >
            <svg id="theme-sun-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5zM2 12c0 5.52 4.48 10 10 10s10-4.48 10-10S17.52 2 12 2 2 6.48 2 12zm10 8c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"></path>
            </svg>
            <svg id="theme-moon-icon" class="hidden" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
              <path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"></path>
            </svg>
          </button>
          <button
            id="voice-toggle-button"
            aria-label="Toggle voice output"
            title="Toggle voice"
          >
            <svg
              id="voice-on-icon"
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 24 24"
              fill="currentColor"
            >
              <path
                d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"
              />
            </svg>
            <svg
              id="voice-off-icon"
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 24 24"
              fill="currentColor"
              class="hidden"
            >
              <path
                d="M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73l-9-9L4.27 3zM12 4L9.91 6.09 12 8.18V4z"
              />
            </svg>
          </button>
        </div>
         <div id="voice-settings-popover" class="hidden">
            <h4>Voice Settings</h4>
            <div class="setting-row">
                <label for="voice-select">Voice</label>
                <select id="voice-select">
                    <option>Loading voices...</option>
                </select>
            </div>
             <div class="setting-row">
                <label for="voice-style-select">Style</label>
                <select id="voice-style-select">
                    <option value="normal">Normal</option>
                    <option value="dramatic">Dramatic</option>
                    <option value="whispering">Whispering</option>
                    <option value="excited">Excited</option>
                    <option value="sarcastic">Sarcastic</option>
                </select>
            </div>
            <div class="setting-row">
                <label for="pitch-slider">Pitch</label>
                <input type="range" id="pitch-slider" min="0.5" max="2" step="0.1" value="1.2">
                <span id="pitch-value">1.2</span>
            </div>
            <div class="setting-row">
                <label for="rate-slider">Rate</label>
                <input type="range" id="rate-slider" min="0.5" max="1.5" step="0.05" value="1.05">
                <span id="rate-value">1.05</span>
            </div>
        </div>
      </header>
      <main id="chat-container"></main>
      <div id="typing-indicator" class="hidden">
        <span>Luna is typing</span>
        <div class="dots">
          <div></div>
          <div></div>
          <div></div>
        </div>
      </div>
       <div id="visualizer-container">
        <canvas id="audio-visualizer"></canvas>
      </div>
      <footer>
        <div id="chat-controls" aria-label="Chat controls">
          <button type="button" id="image-button" class="control-button" aria-label="Generate an image" title="Generate an image">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
              <path d="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z"/>
            </svg>
          </button>
          <button type="button" id="mic-button" aria-label="Start conversation" title="Start conversation">
             <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 14c1.66 0 2.99-1.34 2.99-3L15 5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm5.3-3c0 3-2.54 5.1-5.3 5.1S6.7 14 6.7 11H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c3.28-.49 6-3.31 6-6.72h-1.7z"></path>
            </svg>
          </button>
           <div class="control-button-placeholder"></div>
        </div>
      </footer>
    </div>
    <script type="module" src="index.tsx"></script>
  </body>
</html>